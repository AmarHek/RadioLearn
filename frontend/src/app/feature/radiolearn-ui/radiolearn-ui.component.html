<html>
<body class="disable-select">
<div id="outer" *ngIf="!isMobile">
  <div id="inner_fixed" [ngStyle]="{'margin-bottom' : inputEnabled ? '-27px' : '1px'}">
    <mat-toolbar class="toolbar" color="primary">
      <button mat-button class="header-button" style="font-size: 18px;" (click)='back()'>
        <mat-icon>arrow_back_ios</mat-icon>
        RadioLearn
      </button>
      <span *ngIf="isMod && this.material">{{this.material.scans.mainScan.filename.substring(0,25)}}</span>
      <span class="spacer"></span>
      <button *ngIf="isMod" mat-button class="header-button" id="btnSwitchInput"
              (click)="switchInputMode()">
        <ng-container *ngIf="inputEnabled">Eingabezeile aktiviert</ng-container>
        <ng-container *ngIf="!inputEnabled">Eingabezeile deaktiviert</ng-container>
      </button>
      <button mat-button class="header-button" id="userMode" *ngIf="isAdmin"
              (click)="toggleUserMode()">
        <ng-container *ngIf="userMode">Nutzer: Student</ng-container>
        <ng-container *ngIf="!userMode">Nutzer: Arzt</ng-container>
      </button>
      <button *ngIf="isAdmin" mat-button class="header-button" id="detailedMode"
              (click)="switchMode()">
        <ng-container *ngIf="detailedMode">Modus: Dokumentation</ng-container>
        <ng-container *ngIf="!detailedMode">Modus: Diagnose</ng-container>
      </button>
      <button *ngIf="detailedMode" mat-button class="header-button" id="normal-btn"
              matTooltip="Restliche Kategorien als unauffällig markieren"
              (click)="makeNormal()">Rest normal
      </button>
      <button mat-button class="header-button" id="check" matTooltip="Eingaben überprüfen"
              (click)="checkForErrors()"><mat-icon>checklist_rtl</mat-icon> Überprüfen
      </button>
      <button *ngIf="isMod" mat-button class="header-button" id="save" matTooltip="Speichern"
              (click)="save()"><mat-icon>save</mat-icon>
      </button>
      <button mat-button class="header-button" id="next" matTooltip="Nächste Aufnahme"
              (click)="nextMaterial()"><mat-icon>navigate_next</mat-icon></button>
      <button mat-button class="header-button" id="feedback" matTooltip="Feedback geben"
              (click)="feedbackModal()"><mat-icon>feedback</mat-icon></button>

    </mat-toolbar>

    <mat-form-field class="example-chip-list" appearance="fill" *ngIf="inputEnabled">
      <mat-label>Eingabe</mat-label>
      <mat-chip-list #chipList>
        <mat-chip
          *ngFor="let chip of chips"
          (removed)="remove(chip)"
          (click)="onChipClick(chip)"
          [ngClass]="chip.color">
          {{chip.content}}
          <button matChipRemove>
            <mat-icon>cancel</mat-icon>
          </button>
        </mat-chip>
        <input
          #chipInput
          placeholder="Befund eingeben ..."
          [matChipInputFor]="chipList"
          [(ngModel)]="this.input"
          (input)="onInput()"
        >
      </mat-chip-list>
    </mat-form-field>

  </div>

  <div class="inner_remaining">
    <ng-container *ngIf="detailedMode">
      <mat-selection-list *ngIf="this.deepCategories"
                          class="catSelectionList"
                          (selectionChange)="onSelect($event)"
                          [ngStyle]="{'width.%': userMode ? 12 : 9}"
                          [multiple]="false" [(ngModel)]="selectedCatList">
        <ng-container *ngFor="let cat of deepCategories">
          <mat-list-option [value]="cat.name"
                           [selected]="cat.name === this.selectedCat">
            {{cat.name}}
          </mat-list-option>
        </ng-container>
      </mat-selection-list>

      <app-radiolearn-options [ngStyle]="{'width.%': userMode ? 35 : 25}"
                              [selectedCat]="selectedCat"
                              [selectedSelectableID]="selectedSelectableID"
                              (nextCat)="nextCategory($event)"
                              (updateEmitter)="updateFromOptions()"
                              class="options-expand"
                              [categories]="deepCategories">
      </app-radiolearn-options>
    </ng-container>

    <ng-container *ngIf="!detailedMode">
      <div class="shallowSelectionList"
           [ngStyle]="{'width.%': userMode ? 18 : 18}">

        <ng-container *ngIf="this.material">
          <ng-container *ngFor="let selectable of this.shallowCategories[0].selectables">
            <div style="padding-left: 15px; padding-top: 7px; padding-bottom: 7px">
              <mat-checkbox style="font-size: 17px"
                            (click)="updateFromParent(selectable)"
                            [(ngModel)]="selectable.value"
                            [ngStyle]="{'border' : this.deepCategories[0].name + ' ' + selectable.name ===
                          selectedSelectableID ? '3px solid red' : '3px solid transparent'}"
              >{{selectable.name}}</mat-checkbox>
            </div>

            <ng-container *ngIf="selectable.value">

              <ng-container *ngFor="let variable of selectable.variables">

                <mat-radio-group *ngIf=" variable.kind === 'oc'" [(ngModel)]="variable.value">
                  <ng-container *ngFor="let value of variable.values">
                    <div style="padding-left: 25px; padding-top: 5px; padding-bottom: 5px">
                      <mat-radio-button [value]="value" (click)="updateFromVariable(selectable)">
                        {{value}}
                      </mat-radio-button>
                    </div>
                  </ng-container>
                </mat-radio-group>

                <ng-container *ngIf="variable.kind === 'mc'">
                  <ng-container *ngFor="let value of variable.values">
                    <div style="padding-left: 25px; padding-top: 5px; padding-bottom: 5px">
                      <mat-checkbox [(ngModel)]="value[1]" (click)="updateFromVariable(selectable)">
                        {{value[0]}}
                      </mat-checkbox>
                    </div>
                  </ng-container>
                </ng-container>

              </ng-container>
            </ng-container>

          </ng-container>
        </ng-container>
      </div>
    </ng-container>

    <app-image-display *ngIf="material && !userMode && isMod"
                       [scans]="material.scans"
                       [boxLabels]="boxLabels"
                       [annotations]="material.annotations"></app-image-display>

    <app-image-display-student *ngIf="material && userMode"
                               [scans]="material.scans"
                               [annotations]="material.annotations"></app-image-display-student>
  </div>

</div>



<div id="mobile" *ngIf="isMobile" style="height: 100%;">
  <mat-toolbar class="toolbar" color="primary">
    <button mat-button class="header-button" style="font-size: 18px;" (click)='back()'>
      <mat-icon>arrow_back_ios</mat-icon>
    </button>
    <span class="spacer"></span>
    <button mat-button class="header-button" id="checkMobile" matTooltip="Eingaben überprüfen"
            (click)="checkForErrors()"><mat-icon>checklist_rtl</mat-icon> Überprüfen
    </button>
    <button *ngIf="isMod" mat-button class="header-button" id="saveMobile" matTooltip="Speichern"
            (click)="save()"><mat-icon>save</mat-icon>
    </button>
    <button mat-button class="header-button" id="nextMobile" matTooltip="Nächste Aufnahme"
            (click)="nextMaterial()"><mat-icon>navigate_next</mat-icon></button>

  </mat-toolbar>

  <mat-drawer-container class="example-container" [hasBackdrop]="true" style="height: calc(100% - 60px);">
    <mat-drawer #drawer [mode]="'over'">



      <ng-container *ngIf="this.material">
        <ng-container *ngFor="let selectable of this.shallowCategories[0].selectables">
          <div style="padding-left: 15px; padding-top: 7px; padding-bottom: 7px; padding-right: 7px">
            <mat-checkbox style="font-size: 17px"
                          (click)="updateFromParent(selectable)"
                          [(ngModel)]="selectable.value"
                          [ngStyle]="{'border' : this.deepCategories[0].name + ' ' + selectable.name ===
                          selectedSelectableID ? '3px solid red' : '3px solid transparent'}"
            >{{selectable.name}}</mat-checkbox>
          </div>

          <ng-container *ngIf="selectable.value">

            <ng-container *ngFor="let variable of selectable.variables">

              <mat-radio-group *ngIf=" variable.kind === 'oc'" [(ngModel)]="variable.value">
                <ng-container *ngFor="let value of variable.values">
                  <div style="padding-left: 25px; padding-top: 5px; padding-bottom: 5px">
                    <mat-radio-button [value]="value" (click)="updateFromVariable(selectable)">
                      {{value}}
                    </mat-radio-button>
                  </div>
                </ng-container>
              </mat-radio-group>

              <ng-container *ngIf="variable.kind === 'mc'">
                <ng-container *ngFor="let value of variable.values">
                  <div style="padding-left: 25px; padding-top: 5px; padding-bottom: 5px">
                    <mat-checkbox [(ngModel)]="value[1]" (click)="updateFromVariable(selectable)">
                      {{value[0]}}
                    </mat-checkbox>
                  </div>
                </ng-container>
              </ng-container>

            </ng-container>
          </ng-container>

        </ng-container>
      </ng-container>



    </mat-drawer>
    <mat-drawer-content style="height: 100%">
      <app-image-display-student *ngIf="material && userMode"
                                 [scans]="material.scans"
                                 [isMobile]="isMobile"
                                 [annotations]="material.annotations"></app-image-display-student>
      <button mat-fab color="primary" style="position:fixed; bottom: 15px; left: 15px" (click)="drawer.toggle()">
        <mat-icon>
          toc
        </mat-icon>
      </button>
    </mat-drawer-content>
  </mat-drawer-container>

</div>
</body>
</html>

